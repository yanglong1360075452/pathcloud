<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lifetech.dhap.pathcloud.application.domain.ApplicationRepository">
    <resultMap id="BaseResultMap" type="com.lifetech.dhap.pathcloud.application.domain.model.Application">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Nov 21 17:12:55 CST 2016.
        -->
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="pathology_id" property="pathologyId" jdbcType="BIGINT"/>
        <result column="serial_number" property="serialNumber" jdbcType="CHAR"/>
        <result column="number" property="number" jdbcType="CHAR"/>
        <result column="his_id" property="hisId" jdbcType="VARCHAR"/>
        <result column="patient_name" property="patientName" jdbcType="VARCHAR"/>
        <result column="patient_no" property="patientNo" jdbcType="VARCHAR"/>
        <result column="admission_no" property="admissionNo" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="reject_reason" property="rejectReason" jdbcType="VARCHAR"/>
        <result column="reason_type" property="reasonType" jdbcType="VARCHAR"/>
        <result column="age" property="age" jdbcType="INTEGER"/>
        <result column="sex" property="sex" jdbcType="INTEGER"/>
        <result column="marital_status" property="maritalStatus" jdbcType="INTEGER"/>
        <result column="origin_place" property="originPlace" jdbcType="VARCHAR"/>
        <result column="profession" property="profession" jdbcType="VARCHAR"/>
        <result column="patient_tel" property="patientTel" jdbcType="VARCHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="hospital" property="hospital" jdbcType="INTEGER"/>
        <result column="doctor" property="doctor" jdbcType="VARCHAR"/>
        <result column="departments" property="departments" jdbcType="INTEGER"/>
        <result column="doctor_tel" property="doctorTel" jdbcType="VARCHAR"/>
        <result column="inspection_item" property="inspectionItem" jdbcType="VARCHAR"/>
        <result column="visit_cat" property="visitCat" jdbcType="VARCHAR"/>
        <result column="gynaecology" property="gynaecology" jdbcType="BIT"/>
        <result column="menopause" property="menopause" jdbcType="BIT"/>
        <result column="menopause_time" property="menopauseTime" jdbcType="VARCHAR"/>
        <result column="menopause_end" property="menopauseEnd" jdbcType="DATE"/>
        <result column="hcg" property="hcg" jdbcType="REAL"/>
        <result column="urgent_flag" property="urgentFlag" jdbcType="BIT"/>
        <result column="create_by" property="createBy" jdbcType="BIGINT"/>
        <result column="update_by" property="updateBy" jdbcType="BIGINT"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="gynaecology_remark" property="gynaecologyRemark" jdbcType="LONGVARCHAR"/>
        <result column="clinical_diagnosis" property="clinicalDiagnosis" jdbcType="LONGVARCHAR"/>
        <result column="medical_summary" property="medicalSummary" jdbcType="LONGVARCHAR"/>
        <result column="clinical_findings" property="clinicalFindings" jdbcType="LONGVARCHAR"/>
        <result column="imaging_findings" property="imagingFindings" jdbcType="LONGVARCHAR"/>
        <result column="operation_findings" property="operationFindings" jdbcType="LONGVARCHAR"/>
        <result column="medical_history" property="medicalHistory" jdbcType="LONGVARCHAR"/>
        <result column="history_medicine" property="historyMedicine" jdbcType="LONGVARCHAR"/>
        <result column="history_pathology" property="historyPathology" jdbcType="LONGVARCHAR"/>
        <result column="research" property="research" jdbcType="LONGVARCHAR"/>
        <result column="apply_type" property="applyType" jdbcType="INTEGER"/>
        <result column="applicant" property="applicant" jdbcType="VARCHAR"/>
    </resultMap>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        delete from application
        where id = #{id,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.lifetech.dhap.pathcloud.application.domain.model.Application">
        insert into application (serial_number,number, his_id,
        patient_name, patient_no, admission_no,
        status, reject_reason,reason_type, age,
        sex, marital_status, origin_place,
        profession, patient_tel, address,
        hospital, doctor, departments,
        doctor_tel, inspection_item, visit_cat,
        gynaecology, menopause, menopause_time,
        menopause_end, hcg, urgent_flag,
        create_by, update_by, create_time,
        update_time, gynaecology_remark, clinical_diagnosis,
        medical_summary, clinical_findings,
        imaging_findings,operation_findings, medical_history,
        history_medicine, history_pathology,research,apply_type,applicant
        )
        values (#{serialNumber,jdbcType=CHAR},#{number,jdbcType=CHAR}, #{hisId,jdbcType=VARCHAR},
        #{patientName,jdbcType=VARCHAR}, #{patientNo,jdbcType=VARCHAR}, #{admissionNo,jdbcType=VARCHAR},
        #{status,jdbcType=INTEGER}, #{rejectReason,jdbcType=VARCHAR},#{reasonType,jdbcType=VARCHAR},
        #{age,jdbcType=INTEGER},
        #{sex,jdbcType=INTEGER}, #{maritalStatus,jdbcType=INTEGER}, #{originPlace,jdbcType=VARCHAR},
        #{profession,jdbcType=VARCHAR}, #{patientTel,jdbcType=VARCHAR}, #{address,jdbcType=VARCHAR},
        #{hospital,jdbcType=INTEGER}, #{doctor,jdbcType=VARCHAR}, #{departments,jdbcType=VARCHAR},
        #{doctorTel,jdbcType=VARCHAR}, #{inspectionItem,jdbcType=VARCHAR}, #{visitCat,jdbcType=VARCHAR},
        #{gynaecology,jdbcType=BIT}, #{menopause,jdbcType=BIT}, #{menopauseTime,jdbcType=VARCHAR},
        #{menopauseEnd,jdbcType=DATE}, #{hcg,jdbcType=REAL}, #{urgentFlag,jdbcType=BIT},
        #{createBy,jdbcType=BIGINT}, #{updateBy,jdbcType=BIGINT}, now(),
        #{updateTime,jdbcType=TIMESTAMP}, #{gynaecologyRemark,jdbcType=LONGVARCHAR},
        #{clinicalDiagnosis,jdbcType=LONGVARCHAR},
        #{medicalSummary,jdbcType=LONGVARCHAR}, #{clinicalFindings,jdbcType=LONGVARCHAR},
        #{imagingFindings,jdbcType=LONGVARCHAR},#{operationFindings,jdbcType=LONGVARCHAR},
        #{medicalHistory,jdbcType=LONGVARCHAR},
        #{historyMedicine,jdbcType=LONGVARCHAR}, #{historyPathology,jdbcType=LONGVARCHAR},#{research,jdbcType=LONGVARCHAR},
        #{applyType,jdbcType=INTEGER}, #{applicant,jdbcType=VARCHAR}
        )
    </insert>
    <update id="updateByPrimaryKey" parameterType="com.lifetech.dhap.pathcloud.application.domain.model.Application">
        update application
        set
        serial_number = #{serialNumber,jdbcType=CHAR},
        number = #{number,jdbcType=CHAR},
        his_id = #{hisId,jdbcType=VARCHAR},
        patient_name = #{patientName,jdbcType=VARCHAR},
        patient_no = #{patientNo,jdbcType=VARCHAR},
        admission_no = #{admissionNo,jdbcType=VARCHAR},
        status = #{status,jdbcType=INTEGER},
        reject_reason = #{rejectReason,jdbcType=VARCHAR},
        reason_type = #{reasonType,jdbcType=VARCHAR},
        age = #{age,jdbcType=INTEGER},
        sex = #{sex,jdbcType=INTEGER},
        marital_status = #{maritalStatus,jdbcType=INTEGER},
        origin_place = #{originPlace,jdbcType=VARCHAR},
        profession = #{profession,jdbcType=VARCHAR},
        patient_tel = #{patientTel,jdbcType=VARCHAR},
        address = #{address,jdbcType=VARCHAR},
        hospital = #{hospital,jdbcType=INTEGER},
        doctor = #{doctor,jdbcType=VARCHAR},
        departments = #{departments,jdbcType=INTEGER},
        doctor_tel = #{doctorTel,jdbcType=VARCHAR},
        inspection_item = #{inspectionItem,jdbcType=VARCHAR},
        visit_cat = #{visitCat,jdbcType=VARCHAR},
        gynaecology = #{gynaecology,jdbcType=BIT},
        menopause = #{menopause,jdbcType=BIT},
        menopause_time = #{menopauseTime,jdbcType=VARCHAR},
        menopause_end = #{menopauseEnd,jdbcType=DATE},
        hcg = #{hcg,jdbcType=REAL},
        urgent_flag = #{urgentFlag,jdbcType=BIT},
        create_by = #{createBy,jdbcType=BIGINT},
        update_by = #{updateBy,jdbcType=BIGINT},
        create_time = #{createTime,jdbcType=TIMESTAMP},
        update_time = now(),
        gynaecology_remark = #{gynaecologyRemark,jdbcType=LONGVARCHAR},
        clinical_diagnosis = #{clinicalDiagnosis,jdbcType=LONGVARCHAR},
        medical_summary = #{medicalSummary,jdbcType=LONGVARCHAR},
        clinical_findings = #{clinicalFindings,jdbcType=LONGVARCHAR},
        imaging_findings = #{imagingFindings,jdbcType=LONGVARCHAR},
        operation_findings = #{operationFindings,jdbcType=LONGVARCHAR},
        medical_history = #{medicalHistory,jdbcType=LONGVARCHAR},
        history_medicine = #{historyMedicine,jdbcType=LONGVARCHAR},
        history_pathology = #{historyPathology,jdbcType=LONGVARCHAR},
        research = #{research,jdbcType=LONGVARCHAR},
        apply_type = #{applyType,jdbcType=INTEGER},
        applicant = #{applicant,jdbcType=VARCHAR},
        pathology_id=#{pathologyId,jdbcType=BIGINT}
        where id = #{id,jdbcType=BIGINT}
    </update>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long">
        select id,pathology_id, serial_number, number,his_id, patient_name, patient_no, admission_no, status,
        reject_reason,reason_type, age, sex, marital_status, origin_place, profession, patient_tel, address,
        hospital, doctor, departments, doctor_tel, inspection_item, visit_cat, gynaecology,
        menopause, menopause_time, menopause_end, hcg, urgent_flag, create_by, update_by,
        create_time, update_time, gynaecology_remark, clinical_diagnosis, medical_summary,applicant,
        clinical_findings, imaging_findings,operation_findings, medical_history, history_medicine, history_pathology,research,apply_type
        from application
        where id = #{id,jdbcType=BIGINT}
    </select>
    <select id="selectAll" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Nov 21 17:12:55 CST 2016.
        -->
        select id, pathology_id,serial_number,number, his_id, patient_name, patient_no, admission_no, status,
        reject_reason,reason_type, age, sex, marital_status, origin_place, profession, patient_tel, address,
        hospital, doctor, departments, doctor_tel, inspection_item, visit_cat, gynaecology,
        menopause, menopause_time, menopause_end, hcg, urgent_flag, create_by, update_by,
        create_time, update_time, gynaecology_remark, clinical_diagnosis, medical_summary,applicant,
        clinical_findings, imaging_findings,operation_findings, medical_history, history_medicine, history_pathology,research,apply_type
        from application
    </select>

    <select id="last" resultType="long" useCache="false">
    SELECT LAST_INSERT_ID()
  </select>

    <select id="selectByCondition" resultMap="BaseResultMap"
            parameterType="com.lifetech.dhap.pathcloud.application.application.condition.ApplicationCondition">
        select id, pathology_id,serial_number, number,his_id, patient_name, patient_no, admission_no, status,
        reject_reason, reason_type,age, sex, marital_status, origin_place, profession, patient_tel, address,
        hospital, doctor, departments, doctor_tel, inspection_item, visit_cat, gynaecology,
        menopause, menopause_time, menopause_end, hcg, urgent_flag, create_by, update_by,
        create_time, update_time, gynaecology_remark, clinical_diagnosis, medical_summary,applicant,
        clinical_findings, imaging_findings,operation_findings, medical_history, history_medicine, history_pathology,research,apply_type
        from application
        <where>
            <if test="filter != null">(serial_number = #{filter,jdbcType=VARCHAR} or patient_name like
                CONCAT(#{filter,jdbcType=VARCHAR},'%'))
            </if>
            <if test="createBy != null">and create_by = #{createBy,jdbcType=BIGINT}</if>
            <if test="status != null">and status = #{status,jdbcType=INTEGER}</if>
            <if test="createTimeStart != null">and create_time >= #{createTimeStart,jdbcType=TIMESTAMP}</if>
            <if test="createTimeEnd != null"><![CDATA[and create_time < #{createTimeEnd,jdbcType=TIMESTAMP}]]></if>
        </where>
        <if test="order != null">ORDER BY ${order}</if>
        limit #{start,jdbcType=INTEGER}, #{size,jdbcType=INTEGER}
    </select>

    <select id="countByCondition" resultType="java.lang.Long"
            parameterType="com.lifetech.dhap.pathcloud.application.application.condition.ApplicationCondition">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Nov 21 17:12:55 CST 2016.
        -->
        select count(1)
        from application
        <where>
            <if test="filter != null">(serial_number = #{filter,jdbcType=VARCHAR} or patient_name like
                CONCAT(#{filter,jdbcType=VARCHAR},'%'))
            </if>
            <if test="createBy != null">and create_by = #{createBy,jdbcType=BIGINT}</if>
            <if test="status != null">and status = #{status,jdbcType=INTEGER}</if>
            <if test="createTimeStart != null">and create_time >= #{createTimeStart,jdbcType=TIMESTAMP}</if>
            <if test="createTimeEnd != null"><![CDATA[and create_time < #{createTimeEnd,jdbcType=TIMESTAMP}]]></if>
        </where>
    </select>

    <select id="selectBySerialNumber" resultMap="BaseResultMap" parameterType="java.lang.String">
    select id,pathology_id, serial_number, number,his_id, patient_name, patient_no, admission_no, status,
    reject_reason,reason_type, age, sex, marital_status, origin_place, profession, patient_tel, address,
    hospital, doctor, departments, doctor_tel, inspection_item, visit_cat, gynaecology,
    menopause, menopause_time, menopause_end, hcg, urgent_flag, create_by, update_by,
    create_time, update_time, gynaecology_remark, clinical_diagnosis, medical_summary,applicant,
    clinical_findings, imaging_findings,operation_findings, medical_history, history_medicine, history_pathology,research,apply_type
    from application
    where serial_number = #{serialNumber,jdbcType=CHAR} limit 1
  </select>

    <select id="selectByPathologyNo" resultMap="BaseResultMap" parameterType="java.lang.String">
    select a.id,a.pathology_id, a.serial_number,a.number, a.his_id, a.patient_name, a.patient_no, a.admission_no, a.status,
    a.reject_reason,a.reason_type, a.age, a.sex, a.marital_status, a.origin_place, a.profession, a.patient_tel, a.address,
    a.hospital, a.doctor, a.departments, a.doctor_tel, a.inspection_item, a.visit_cat,a.gynaecology,
    a.menopause, a.menopause_time, a.menopause_end, a.hcg, a.urgent_flag, a.create_by, a.update_by,
    a.create_time, a.update_time, a.gynaecology_remark, a.clinical_diagnosis, a.medical_summary,applicant,
    a.clinical_findings, a.imaging_findings,a.operation_findings, a.medical_history, a.history_medicine, a.history_pathology,a.research,a.apply_type
    from application a
    INNER join pathology p on a.pathology_id = p.id
    where p.serial_number = #{pathologyNo,jdbcType=CHAR}
  </select>

    <select id="selectLastByPathNo" resultMap="BaseResultMap" parameterType="java.lang.String">
            select a.id,a.pathology_id, a.serial_number,a.number, a.his_id, a.patient_name, a.patient_no, a.admission_no, a.status,
    a.reject_reason,a.reason_type, a.age, a.sex, a.marital_status, a.origin_place, a.profession, a.patient_tel, a.address,
    a.hospital, a.doctor, a.departments, a.doctor_tel, a.inspection_item, a.visit_cat,a.gynaecology,
    a.menopause, a.menopause_time, a.menopause_end, a.hcg, a.urgent_flag, a.create_by, a.update_by,
    a.create_time, a.update_time, a.gynaecology_remark, a.clinical_diagnosis, a.medical_summary,applicant,
    a.clinical_findings, a.imaging_findings,a.operation_findings, a.medical_history, a.history_medicine, a.history_pathology,a.research,a.apply_type
    from application a
    INNER join pathology p on a.pathology_id = p.id
    where p.serial_number = #{pathologyNo,jdbcType=CHAR}
    ORDER BY create_time DESC
    limit 1
    </select>

    <resultMap id="SampleMap" type="com.lifetech.dhap.pathcloud.application.domain.model.ApplicationSample">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="serial_number" property="serialNumber" jdbcType="CHAR"/>
        <result column="number" property="number" jdbcType="CHAR"/>
        <result column="his_id" property="hisId" jdbcType="VARCHAR"/>
        <result column="patient_name" property="patientName" jdbcType="VARCHAR"/>
        <result column="patient_no" property="patientNo" jdbcType="VARCHAR"/>
        <result column="admission_no" property="admissionNo" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="pathology_status" property="pathologyStatus" jdbcType="INTEGER"/>
        <result column="reject_reason" property="rejectReason" jdbcType="VARCHAR"/>
        <result column="reason_type" property="reasonType" jdbcType="VARCHAR"/>
        <result column="age" property="age" jdbcType="INTEGER"/>
        <result column="sex" property="sex" jdbcType="INTEGER"/>
        <result column="marital_status" property="maritalStatus" jdbcType="INTEGER"/>
        <result column="origin_place" property="originPlace" jdbcType="VARCHAR"/>
        <result column="profession" property="profession" jdbcType="VARCHAR"/>
        <result column="patient_tel" property="patientTel" jdbcType="VARCHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="hospital" property="hospital" jdbcType="INTEGER"/>
        <result column="doctor" property="doctor" jdbcType="VARCHAR"/>
        <result column="departments" property="departments" jdbcType="INTEGER"/>
        <result column="doctor_tel" property="doctorTel" jdbcType="VARCHAR"/>
        <result column="inspection_item" property="inspectionItem" jdbcType="VARCHAR"/>
        <result column="visit_cat" property="visitCat" jdbcType="VARCHAR"/>
        <result column="gynaecology" property="gynaecology" jdbcType="BIT"/>
        <result column="menopause" property="menopause" jdbcType="BIT"/>
        <result column="menopause_time" property="menopauseTime" jdbcType="VARCHAR"/>
        <result column="menopause_end" property="menopauseEnd" jdbcType="DATE"/>
        <result column="hcg" property="hcg" jdbcType="REAL"/>
        <result column="urgent_flag" property="urgentFlag" jdbcType="BIT"/>
        <result column="create_by" property="createBy" jdbcType="BIGINT"/>
        <result column="update_by" property="updateBy" jdbcType="BIGINT"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="gynaecology_remark" property="gynaecologyRemark" jdbcType="LONGVARCHAR"/>
        <result column="clinical_diagnosis" property="clinicalDiagnosis" jdbcType="LONGVARCHAR"/>
        <result column="medical_summary" property="medicalSummary" jdbcType="LONGVARCHAR"/>
        <result column="clinical_findings" property="clinicalFindings" jdbcType="LONGVARCHAR"/>
        <result column="imaging_findings" property="imagingFindings" jdbcType="LONGVARCHAR"/>
        <result column="operation_findings" property="operationFindings" jdbcType="LONGVARCHAR"/>
        <result column="medical_history" property="medicalHistory" jdbcType="LONGVARCHAR"/>
        <result column="history_medicine" property="historyMedicine" jdbcType="LONGVARCHAR"/>
        <result column="history_pathology" property="historyPathology" jdbcType="LONGVARCHAR"/>

        <result column="pathologyId" property="pathologyId" jdbcType="BIGINT"/>
        <result column="sample_id" property="sampleId" jdbcType="BIGINT"/>
        <result column="application_id" property="applicationId" jdbcType="BIGINT"/>
        <result column="sample_number" property="sampleNumber" jdbcType="CHAR"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="category" property="category" jdbcType="INTEGER"/>
        <result column="note" property="note" jdbcType="LONGVARCHAR"/>
        <result column="pathology_number" property="pathologyNumber" jdbcType="CHAR"/>
        <result column="assign_grossing" property="assignGrossing" jdbcType="BIGINT"/>
        <result column="sample_create_by" property="sampleCreateBy" jdbcType="BIGINT"/>
        <result column="sample_update_by" property="sampleUpdateBy" jdbcType="BIGINT"/>
        <result column="sample_create_time" property="sampleCreateTime" jdbcType="TIMESTAMP"/>
        <result column="sample_update_time" property="sampleUpdateTime" jdbcType="TIMESTAMP"/>
        <result column="delete" property="delete" jdbcType="BIT"/>
    </resultMap>

    <select id="selectSampleAndApplicationByCondition" resultMap="SampleMap"
            parameterType="com.lifetech.dhap.pathcloud.application.application.condition.ApplicationCondition">
        SELECT * FROM (
        select t.id, t.serial_number, t.his_id, t.patient_name, t.status,if(sa.number is NULL ,t2.status,sa.status) as pathology_status,
        t.reject_reason,t.reason_type, t.doctor, t.departments, t.doctor_tel, t.inspection_item, t.visit_cat,
        t.urgent_flag, t.create_by, t1.serial_number as sample_number, t1.name, t1.id as sample_id,
        t1.application_id as application_id, t1.category as category, t1.note as note, t2.serial_number as pathology_number,
        t.create_time,t2.assign_grossing,t1.create_by as sample_create_by,t1.update_by as sample_update_by,
        t1.create_time as sample_create_time,t1.update_time as
        sample_update_time,t1.delete,t.update_by,t.update_time,t2.id as pathologyId,
        sa.number,if(sa.number is null,0,sa.type) as type
        from application t
        LEFT join sample t1 on t1.application_id = t.id
        LEFT JOIN pathology t2 on t2.id = t.pathology_id
        LEFT JOIN special_application sa on sa.number = t.number
        ) as table1
        <where>
            /*过滤申请单状态为已撤销的*/
            table1.status != 4
            <if test="filter != null and filter != '' ">and (serial_number = #{filter,jdbcType=VARCHAR} or pathology_number =
                #{filter,jdbcType=VARCHAR} or sample_number = #{filter,jdbcType=VARCHAR} or patient_name like
                CONCAT(#{filter,jdbcType=VARCHAR},'%'))
            </if>
            <if test="specialType != null">and TYPE = #{specialType,jdbcType=INTEGER}</if>
            <if test="status != null and status != 41">and status = #{status,jdbcType=INTEGER}</if>
            <if test="status == 41">and pathology_status = #{status,jdbcType=INTEGER}</if>
            <if test="createTimeStart != null">and create_time >= #{createTimeStart,jdbcType=TIMESTAMP}</if>
            <if test="createTimeEnd != null"><![CDATA[and create_time < #{createTimeEnd,jdbcType=TIMESTAMP}]]></if>
        </where>
        <if test="order != null">ORDER BY ${order}</if>
        limit #{start,jdbcType=INTEGER}, #{size,jdbcType=INTEGER}
    </select>

    <select id="countSampleAndApplicationByCondition" resultType="java.lang.Long"
            parameterType="com.lifetech.dhap.pathcloud.application.application.condition.ApplicationCondition">
        SELECT count(1) FROM (
        select t.id, t.serial_number, t.his_id, t.patient_name, t.status,if(sa.number is NULL ,t2.status,sa.status) as pathology_status,
        t.reject_reason,t.reason_type, t.doctor, t.departments, t.doctor_tel, t.inspection_item, t.visit_cat,
        t.urgent_flag, t.create_by, t1.serial_number as sample_number, t1.name, t1.id as sample_id,
        t1.application_id as application_id, t1.category as category, t1.note as note, t2.serial_number as pathology_number,
        t.create_time,t2.assign_grossing,t1.create_by as sample_create_by,t1.update_by as sample_update_by,
        t1.create_time as sample_create_time,t1.update_time as
        sample_update_time,t1.delete,t.update_by,t.update_time,t2.id as pathologyId,
        sa.number,if(sa.number is null,0,sa.type) as type
        from application t
        LEFT join sample t1 on t1.application_id = t.id
        LEFT JOIN pathology t2 on t2.id = t.pathology_id
        LEFT JOIN special_application sa on sa.number = t.number
        ) as table1
        <where>
            /*过滤申请单状态为已撤销的*/
            table1.status != 4
            <if test="filter != null and filter != '' ">and (serial_number = #{filter,jdbcType=VARCHAR} or pathology_number =
                #{filter,jdbcType=VARCHAR} or sample_number = #{filter,jdbcType=VARCHAR} or patient_name like
                CONCAT(#{filter,jdbcType=VARCHAR},'%'))
            </if>
            <if test="specialType != null">and TYPE = #{specialType,jdbcType=INTEGER}</if>
            <if test="status != null and status != 41">and status = #{status,jdbcType=INTEGER}</if>
            <if test="status == 41">and pathology_status = #{status,jdbcType=INTEGER}</if>
            <if test="createTimeStart != null">and create_time >= #{createTimeStart,jdbcType=TIMESTAMP}</if>
            <if test="createTimeEnd != null"><![CDATA[and create_time < #{createTimeEnd,jdbcType=TIMESTAMP}]]></if>
        </where>
    </select>

    <update id="updateStatusById" parameterType="map">
    update application set
    status=#{status,jdbcType=INTEGER},
    update_by = #{updateBy,jdbcType=BIGINT},
    reject_reason=#{rejectReason,jdbcType=VARCHAR},
    reason_type=#{reasonType,jdbcType=VARCHAR},
    update_time = now()
    <if test="pathId != null">,pathology_id=#{pathId,jdbcType=BIGINT}</if>
    <if test="number != null">,number=#{number,jdbcType=CHAR}</if>
    where id = #{id,jdbcType=BIGINT};
  </update>

    <select id="selectInspectDoctor" resultType="java.lang.Long">
        select DISTINCT(create_by) from application
    </select>

    <select id="countDepartments" resultType="java.lang.Long" parameterType="java.lang.Integer">
        SELECT COUNT(1) from application WHERE departments=#{code,jdbcType=INTEGER}
    </select>

    <select id="getApplicationBySampleSerialNumber" resultMap="BaseResultMap" parameterType="java.lang.String">
    select a.id,a.pathology_id, a.serial_number,a.number, a.his_id, a.patient_name, a.patient_no, a.admission_no, a.status,
    a.reject_reason,a.reason_type, a.age, a.sex, a.marital_status, a.origin_place, a.profession, a.patient_tel, a.address,
    a.hospital, a.doctor, a.departments, a.doctor_tel, a.inspection_item, a.visit_cat, a.gynaecology,
    a.menopause, a.menopause_time, a.menopause_end, a.hcg, a.urgent_flag, a.create_by, a.update_by,
    a.create_time, a.update_time, a.gynaecology_remark, a.clinical_diagnosis, a.medical_summary,a.applicant,
    a.clinical_findings, a.imaging_findings,a.operation_findings, a.medical_history, a.history_medicine, a.history_pathology,a.research,a.apply_type
    from application a
    LEFT JOIN sample s on s.application_id=a.id
    where s.serial_number = #{serialNumber,jdbcType=CHAR} limit 1
  </select>

    <select id="selectIdsByPathId" parameterType="java.lang.Long" resultType="java.lang.Long">
        SELECT id FROM application WHERE pathology_id = #{pathId,jdbcType=BIGINT}
    </select>
</mapper>